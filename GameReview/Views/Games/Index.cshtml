@model IEnumerable<GameReview.Models.Game>
@using Microsoft.AspNetCore.Identity
@inject SignInManager<IdentityUser> SignInManager

@{
    ViewData["Title"] = "一覧";

}

    <h1>一覧</h1>

    <p>
        <a asp-action="Create">Create New</a>
        <a asp-action="Index" asp-route-sortOrder="">ソートクリア</a>
    </p>
<div class="table-responsive">
    <table class="table  table-striped table-hover">
        <thead class="thead-light">
            <tr class="">
                <th class="text-nowrap">
                    #
                </th>

                <th class="text-nowrap">
                    <a asp-action="Index" asp-route-sortOrder="@((string)ViewData["SortParm"] == "title" ? "title_desc" : "title")">
                        @Html.DisplayNameFor(model => model.Title)

                        @if ((string)ViewData["SortParm"] == "title")
                        {
                            <i class="fas fa-sort-up"></i>
                        }
                        else if ((string)ViewData["SortParm"] == "title_desc")
                        {
                            <i class="fas fa-sort-down"></i>
                        }
                        else
                        {
                            <i class="fas fa-sort"></i>
                        }
                    </a>
                </th>
                <th class="text-nowrap">
                    <a asp-action="Index" asp-route-sortOrder="@((string)ViewData["SortParm"] == "grade" ? "grade_desc" : "grade")">
                        @Html.DisplayNameFor(model => model.Reviews.FirstOrDefault().Grade)
                        @if ((string)ViewData["SortParm"] == "grade")
                        {
                            <i class="fas fa-sort-up"></i>
                        }
                        else if ((string)ViewData["SortParm"] == "grade_desc")
                        {
                            <i class="fas fa-sort-down"></i>
                        }
                        else
                        {
                            <i class="fas fa-sort"></i>
                        }
                    </a>
                </th>
                <th class="text-nowrap">
                    @Html.DisplayNameFor(model => model.Reviews.FirstOrDefault().Summary)
                </th>


                <th class=""></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr class="">
                    <td>
                        <img src="@Html.DisplayFor(modelItem => item.ImagePath)" alt="" class="" />
                    </td>

                    <td>
                        @Html.DisplayFor(modelItem => item.Title)
                    </td>
                    <td>
                        @foreach (var i in item.Reviews)
                        {
                            @Html.DisplayFor(modelItem => i.Grade)
                        }
                    </td>
                    <td>
                        @foreach (var i in item.Reviews)
                        {
                            @Html.DisplayFor(modelItem => i.Summary)
                        }
                    </td>
                    <td class="text-nowrap float-right">

                        @if (item.Reviews.FirstOrDefault() == null)
                        {
                        <button class="btn btn-secondary disabled">未評価</button>

                        }
                        else
                        {
                            <a class="btn btn-info" asp-action="Details" asp-route-id="@item.ID">詳細</a>
                        }
                        @if (SignInManager.IsSignedIn(User))
                        {
                            <text>|</text>
                            <a class="btn btn-info"asp-action="Edit" asp-route-id="@item.ID">編集</a> <text>|</text>
                            <a class="btn btn-danger" asp-action="Delete" asp-route-id="@item.ID">削除</a>
                        }

                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

